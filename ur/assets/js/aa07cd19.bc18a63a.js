"use strict";(globalThis.webpackChunkphysical_ai_textbook=globalThis.webpackChunkphysical_ai_textbook||[]).push([[2385],{4686(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"module1-ros2/chapter2","title":"Chapter 2: Nodes, Topics, and Services","description":"Learning Objectives","source":"@site/docs/module1-ros2/chapter2.mdx","sourceDirName":"module1-ros2","slug":"/module1-ros2/chapter2","permalink":"/Hackathon-One-Physical-AI-Humanoid-Robotics-Course-/ur/docs/module1-ros2/chapter2","draft":false,"unlisted":false,"editUrl":"https://github.com/samreensaif/Hackathon-One-Physical-AI-Humanoid-Robotics-Course-/tree/main/physical-ai-textbook/docs/module1-ros2/chapter2.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Chapter 2: Nodes, Topics, and Services","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 1: Introduction to ROS 2","permalink":"/Hackathon-One-Physical-AI-Humanoid-Robotics-Course-/ur/docs/module1-ros2/chapter1"},"next":{"title":"Chapter 3: Building ROS 2 Packages","permalink":"/Hackathon-One-Physical-AI-Humanoid-Robotics-Course-/ur/docs/module1-ros2/chapter3"}}');var i=s(4848),t=s(8453),o=s(7132),l=s(20);const a={title:"Chapter 2: Nodes, Topics, and Services",sidebar_position:2},d="Chapter 2: Nodes, Topics, and Services",c={},h=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"2.1 The Node: Your Building Block",id:"21-the-node-your-building-block",level:2},{value:"Understanding <code>rclpy.spin()</code>",id:"understanding-rclpyspin",level:3},{value:"Object-Oriented Node Style",id:"object-oriented-node-style",level:3},{value:"2.2 Topics: Asynchronous Data Streams",id:"22-topics-asynchronous-data-streams",level:2},{value:"Message Types",id:"message-types",level:3},{value:"2.3 Writing a Publisher",id:"23-writing-a-publisher",level:2},{value:"Key Points",id:"key-points",level:3},{value:"2.4 Writing a Subscriber",id:"24-writing-a-subscriber",level:2},{value:"Running Both Nodes",id:"running-both-nodes",level:3},{value:"2.5 Quality of Service (QoS) Policies",id:"25-quality-of-service-qos-policies",level:2},{value:"QoS Compatibility Rules",id:"qos-compatibility-rules",level:3},{value:"Pre-defined QoS Profiles",id:"pre-defined-qos-profiles",level:3},{value:"2.6 Working with Geometry Messages",id:"26-working-with-geometry-messages",level:2},{value:"2.7 Services: Synchronous Request/Response",id:"27-services-synchronous-requestresponse",level:2},{value:"The Service Definition",id:"the-service-definition",level:3},{value:"The Service Server",id:"the-service-server",level:3},{value:"The Service Client",id:"the-service-client",level:3},{value:"2.8 A Practical Example: Sensor Fusion Node",id:"28-a-practical-example-sensor-fusion-node",level:2},{value:"2.9 Parameters: Runtime Configuration",id:"29-parameters-runtime-configuration",level:2},{value:"2.10 Introspecting the Computation Graph",id:"210-introspecting-the-computation-graph",level:2},{value:"2.11 Chapter Summary",id:"211-chapter-summary",level:2},{value:"Review Questions",id:"review-questions",level:2}];function p(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.A,{}),"\n",(0,i.jsx)(l.A,{}),"\n",(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"chapter-2-nodes-topics-and-services",children:"Chapter 2: Nodes, Topics, and Services"})}),"\n",(0,i.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,i.jsx)(n.p,{children:"By the end of this chapter, you will be able to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Create a ROS 2 node in Python using the ",(0,i.jsx)(n.code,{children:"rclpy"})," library"]}),"\n",(0,i.jsx)(n.li,{children:"Implement a publisher that sends custom messages on a topic"}),"\n",(0,i.jsx)(n.li,{children:"Implement a subscriber that receives and processes messages"}),"\n",(0,i.jsx)(n.li,{children:"Understand Quality-of-Service (QoS) settings and when to use them"}),"\n",(0,i.jsx)(n.li,{children:"Build a service server and client for request/response communication"}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"ros2"})," command-line tools to introspect a live system"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"21-the-node-your-building-block",children:"2.1 The Node: Your Building Block"}),"\n",(0,i.jsxs)(n.p,{children:["In ROS 2, every piece of application logic lives inside a ",(0,i.jsx)(n.strong,{children:"node"}),". A node is a process that:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Has a unique name within the ROS 2 graph"}),"\n",(0,i.jsx)(n.li,{children:"Can advertise publishers and create subscribers"}),"\n",(0,i.jsx)(n.li,{children:"Can create service servers and clients"}),"\n",(0,i.jsx)(n.li,{children:"Can declare and read parameters"}),"\n",(0,i.jsx)(n.li,{children:"Has its own logger (for structured console output)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The smallest possible ROS 2 Python program is:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\ndef main():\n    rclpy.init()                        # Initialise the ROS 2 context\n    node = Node('my_first_node')        # Create a node with a name\n    node.get_logger().info('Hello, ROS 2!')\n    rclpy.spin(node)                    # Block, processing callbacks\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"understanding-rclpyspin",children:["Understanding ",(0,i.jsx)(n.code,{children:"rclpy.spin()"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"rclpy.spin(node)"})," enters an ",(0,i.jsx)(n.strong,{children:"event loop"}),". It blocks the current thread and dispatches incoming messages to their registered callback functions. When you press ",(0,i.jsx)(n.code,{children:"Ctrl+C"}),", it receives a ",(0,i.jsx)(n.code,{children:"SIGINT"})," signal and the spin returns, allowing graceful shutdown."]}),"\n",(0,i.jsx)(n.p,{children:"There are several spin variants:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"rclpy.spin(node)                 # Block indefinitely\nrclpy.spin_once(node)            # Process one callback and return\nrclpy.spin_until_future_complete(node, future)  # Block until an async result\n"})}),"\n",(0,i.jsx)(n.h3,{id:"object-oriented-node-style",children:"Object-Oriented Node Style"}),"\n",(0,i.jsxs)(n.p,{children:["For any real project, you should extend ",(0,i.jsx)(n.code,{children:"Node"})," into your own class. This is the idiomatic pattern used throughout the ROS 2 ecosystem:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass MyRobotNode(Node):\n    def __init__(self):\n        super().__init__('my_robot_node')\n        self.get_logger().info('Node has started.')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = MyRobotNode()\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"args=None"})," parameter allows ROS 2 to parse command-line arguments passed to the node (such as remappings and parameter overrides)."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"22-topics-asynchronous-data-streams",children:"2.2 Topics: Asynchronous Data Streams"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.strong,{children:"topic"})," is a named data channel. The communication model is ",(0,i.jsx)(n.strong,{children:"anonymous publish-subscribe"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["A ",(0,i.jsx)(n.strong,{children:"publisher"})," sends messages to a topic without knowing who is listening"]}),"\n",(0,i.jsxs)(n.li,{children:["A ",(0,i.jsx)(n.strong,{children:"subscriber"})," receives messages from a topic without knowing who sent them"]}),"\n",(0,i.jsx)(n.li,{children:"Any number of publishers and subscribers can share a topic"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This decoupling is powerful: you can add a data-recording node that subscribes to ",(0,i.jsx)(n.code,{children:"/camera/image_raw"})," without modifying the camera driver node at all."]}),"\n",(0,i.jsx)(n.h3,{id:"message-types",children:"Message Types"}),"\n",(0,i.jsxs)(n.p,{children:["Every topic has a fixed ",(0,i.jsx)(n.strong,{children:"message type"}),". ROS 2 ships with hundreds of standard message types in the ",(0,i.jsx)(n.code,{children:"std_msgs"}),", ",(0,i.jsx)(n.code,{children:"sensor_msgs"}),", ",(0,i.jsx)(n.code,{children:"geometry_msgs"}),", and ",(0,i.jsx)(n.code,{children:"nav_msgs"})," packages. You can also define custom message types (covered in Chapter 3)."]}),"\n",(0,i.jsx)(n.p,{children:"Common message types you will use frequently:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Message Type"}),(0,i.jsx)(n.th,{children:"Package"}),(0,i.jsx)(n.th,{children:"Contents"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"String"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"std_msgs"})}),(0,i.jsx)(n.td,{children:"A single string field"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"Int32"}),", ",(0,i.jsx)(n.code,{children:"Float64"})]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"std_msgs"})}),(0,i.jsx)(n.td,{children:"Single integer or float"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Header"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"std_msgs"})}),(0,i.jsx)(n.td,{children:"Timestamp + frame ID"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Image"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sensor_msgs"})}),(0,i.jsx)(n.td,{children:"Camera frame (encoding, data)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"LaserScan"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sensor_msgs"})}),(0,i.jsx)(n.td,{children:"2D lidar scan"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Imu"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sensor_msgs"})}),(0,i.jsx)(n.td,{children:"IMU (gyro + accelerometer + orientation)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Pose"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"geometry_msgs"})}),(0,i.jsx)(n.td,{children:"3D position + orientation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Twist"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"geometry_msgs"})}),(0,i.jsx)(n.td,{children:"Linear + angular velocity"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Odometry"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"nav_msgs"})}),(0,i.jsx)(n.td,{children:"Robot pose + velocity"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"23-writing-a-publisher",children:"2.3 Writing a Publisher"}),"\n",(0,i.jsxs)(n.p,{children:["The following publisher simulates a temperature sensor, publishing a ",(0,i.jsx)(n.code,{children:"Float64"})," reading every second."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# temperature_publisher.py\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float64\nimport random\n\nclass TemperatureSensor(Node):\n    """\n    Simulates a temperature sensor that publishes\n    readings on the /temperature topic.\n    """\n    def __init__(self):\n        super().__init__(\'temperature_sensor\')\n\n        # Create a publisher\n        # Arguments: message type, topic name, QoS queue depth\n        self.publisher_ = self.create_publisher(\n            Float64,          # Message type\n            \'/temperature\',   # Topic name\n            10                # QoS history depth (keep last 10 messages)\n        )\n\n        # Create a timer that fires every 1.0 seconds\n        timer_period = 1.0  # seconds\n        self.timer = self.create_timer(timer_period, self.publish_temperature)\n\n        self.get_logger().info(\'Temperature sensor node started.\')\n\n    def publish_temperature(self):\n        """Callback: called every timer_period seconds."""\n        msg = Float64()\n        # Simulate a temperature between 36.0 and 40.0 degrees Celsius\n        msg.data = 36.0 + random.uniform(0.0, 4.0)\n\n        self.publisher_.publish(msg)\n        self.get_logger().info(f\'Publishing temperature: {msg.data:.2f}\xb0C\')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = TemperatureSensor()\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"key-points",children:"Key Points"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"create_publisher(MsgType, topic, qos_depth)"})," registers the publisher with the ROS 2 graph. The topic is created automatically."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"create_timer(period_seconds, callback)"})," registers a timer callback. ROS 2 will call ",(0,i.jsx)(n.code,{children:"publish_temperature"})," every second."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"publisher_.publish(msg)"})," serialises the message and sends it over DDS."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"24-writing-a-subscriber",children:"2.4 Writing a Subscriber"}),"\n",(0,i.jsxs)(n.p,{children:["Now let's write a node that subscribes to the ",(0,i.jsx)(n.code,{children:"/temperature"})," topic and triggers an alert when the value is dangerously high."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# temperature_monitor.py\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float64\n\nFEVER_THRESHOLD = 38.5  # degrees Celsius\n\nclass TemperatureMonitor(Node):\n    \"\"\"\n    Monitors temperature readings and logs alerts\n    when the temperature exceeds the fever threshold.\n    \"\"\"\n    def __init__(self):\n        super().__init__('temperature_monitor')\n\n        # Create a subscription\n        # Arguments: message type, topic name, callback, QoS depth\n        self.subscription = self.create_subscription(\n            Float64,\n            '/temperature',\n            self.temperature_callback,  # Called each time a message arrives\n            10\n        )\n\n        self.get_logger().info(\n            f'Monitor started. Alert threshold: {FEVER_THRESHOLD}\xb0C'\n        )\n\n    def temperature_callback(self, msg: Float64):\n        \"\"\"\n        This method is called automatically by rclpy\n        whenever a new message arrives on /temperature.\n        \"\"\"\n        temp = msg.data\n\n        if temp > FEVER_THRESHOLD:\n            self.get_logger().warn(\n                f'HIGH TEMPERATURE ALERT: {temp:.2f}\xb0C '\n                f'(threshold: {FEVER_THRESHOLD}\xb0C)'\n            )\n        else:\n            self.get_logger().info(f'Temperature normal: {temp:.2f}\xb0C')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = TemperatureMonitor()\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"running-both-nodes",children:"Running Both Nodes"}),"\n",(0,i.jsx)(n.p,{children:"Open three terminals:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Terminal 1: Run the publisher\npython3 temperature_publisher.py\n\n# Terminal 2: Run the subscriber\npython3 temperature_monitor.py\n\n# Terminal 3: Inspect the live topic\nros2 topic echo /temperature\nros2 topic hz /temperature    # Measures the publishing rate\nros2 topic info /temperature  # Shows type, publishers, subscribers\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"25-quality-of-service-qos-policies",children:"2.5 Quality of Service (QoS) Policies"}),"\n",(0,i.jsxs)(n.p,{children:["The default QoS depth of ",(0,i.jsx)(n.code,{children:"10"})," is a shorthand for a ",(0,i.jsx)(n.strong,{children:"QoS profile"}),". For more control, use ",(0,i.jsx)(n.code,{children:"rclpy.qos.QoSProfile"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from rclpy.qos import QoSProfile, ReliabilityPolicy, HistoryPolicy, DurabilityPolicy\n\n# "Reliable sensor" profile: every message must be delivered\nreliable_qos = QoSProfile(\n    reliability=ReliabilityPolicy.RELIABLE,\n    history=HistoryPolicy.KEEP_LAST,\n    depth=10,\n    durability=DurabilityPolicy.VOLATILE\n)\n\n# "Best effort" profile: for high-frequency data where dropped frames are OK\nbest_effort_qos = QoSProfile(\n    reliability=ReliabilityPolicy.BEST_EFFORT,\n    history=HistoryPolicy.KEEP_LAST,\n    depth=1,\n)\n\nself.publisher_ = self.create_publisher(Float64, \'/temperature\', reliable_qos)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"qos-compatibility-rules",children:"QoS Compatibility Rules"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Important"}),": the publisher and subscriber QoS policies must be compatible, or the connection will silently fail. The rule is:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Publisher"}),(0,i.jsx)(n.th,{children:"Subscriber"}),(0,i.jsx)(n.th,{children:"Result"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"RELIABLE"}),(0,i.jsx)(n.td,{children:"RELIABLE"}),(0,i.jsx)(n.td,{children:"\u2705 Connected"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"RELIABLE"}),(0,i.jsx)(n.td,{children:"BEST_EFFORT"}),(0,i.jsx)(n.td,{children:"\u2705 Connected"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"BEST_EFFORT"}),(0,i.jsx)(n.td,{children:"RELIABLE"}),(0,i.jsx)(n.td,{children:"\u274c Incompatible"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"BEST_EFFORT"}),(0,i.jsx)(n.td,{children:"BEST_EFFORT"}),(0,i.jsx)(n.td,{children:"\u2705 Connected"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"You can diagnose QoS mismatches with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 topic info /temperature --verbose\n"})}),"\n",(0,i.jsx)(n.h3,{id:"pre-defined-qos-profiles",children:"Pre-defined QoS Profiles"}),"\n",(0,i.jsx)(n.p,{children:"ROS 2 ships with sensible built-in profiles for common use cases:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import qos_profile_sensor_data        # Best-effort, keep last 5\nfrom rclpy.qos import qos_profile_system_default     # Reliable, keep last 10\nfrom rclpy.qos import qos_profile_services_default   # For services\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"26-working-with-geometry-messages",children:"2.6 Working with Geometry Messages"}),"\n",(0,i.jsxs)(n.p,{children:["In robotics, the most commonly published data is geometric: positions, orientations, and velocities. Let's write a robot velocity controller that publishes ",(0,i.jsx)(n.code,{children:"Twist"})," messages \u2014 the standard way to command a robot's motion."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# robot_driver.py\nimport rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import Twist\nimport math\n\nclass RobotDriver(Node):\n    \"\"\"\n    Commands a differential-drive robot to drive in a square.\n    Publishes Twist messages to /cmd_vel.\n    \"\"\"\n    def __init__(self):\n        super().__init__('robot_driver')\n\n        self.publisher_ = self.create_publisher(Twist, '/cmd_vel', 10)\n\n        # State machine: 0 = drive forward, 1 = turn\n        self.phase = 0\n        self.phase_count = 0\n\n        # Timer at 10 Hz\n        self.timer = self.create_timer(0.1, self.control_loop)\n\n        self.get_logger().info('Robot driver node started.')\n\n    def control_loop(self):\n        msg = Twist()  # All fields default to 0.0\n\n        if self.phase == 0:\n            # Drive forward at 0.3 m/s for 3 seconds (30 ticks \xd7 0.1s)\n            msg.linear.x = 0.3\n            msg.angular.z = 0.0\n            self.phase_count += 1\n            if self.phase_count >= 30:\n                self.phase = 1\n                self.phase_count = 0\n                self.get_logger().info('Switching to turning phase.')\n        else:\n            # Turn left at \u03c0/4 rad/s for 2 seconds (20 ticks \xd7 0.1s)\n            msg.linear.x = 0.0\n            msg.angular.z = math.pi / 4\n            self.phase_count += 1\n            if self.phase_count >= 20:\n                self.phase = 0\n                self.phase_count = 0\n                self.get_logger().info('Switching to driving phase.')\n\n        self.publisher_.publish(msg)\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = RobotDriver()\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        # On shutdown, publish zero velocity to stop the robot\n        stop_msg = Twist()\n        node.publisher_.publish(stop_msg)\n        node.get_logger().info('Stopping robot.')\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"Twist"})," message encodes motion as:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"linear.x"})," \u2014 forward velocity (m/s)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"linear.y"})," \u2014 lateral velocity (m/s, for holonomic robots)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"angular.z"})," \u2014 rotation rate (rad/s, positive = counter-clockwise)"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"27-services-synchronous-requestresponse",children:"2.7 Services: Synchronous Request/Response"}),"\n",(0,i.jsxs)(n.p,{children:["Topics are fire-and-forget: the publisher does not know if anyone received the message. Services provide a ",(0,i.jsx)(n.strong,{children:"confirmed, synchronous"})," call-and-response pattern, like calling a function on a remote node."]}),"\n",(0,i.jsx)(n.h3,{id:"the-service-definition",children:"The Service Definition"}),"\n",(0,i.jsxs)(n.p,{children:["Services are defined with a request and response pair, separated by ",(0,i.jsx)(n.code,{children:"---"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# AddTwoInts.srv\nint64 a\nint64 b\n---\nint64 sum\n"})}),"\n",(0,i.jsxs)(n.p,{children:["For built-in services, ",(0,i.jsx)(n.code,{children:"example_interfaces/srv/AddTwoInts"})," is the classic example."]}),"\n",(0,i.jsx)(n.h3,{id:"the-service-server",children:"The Service Server"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# add_two_ints_server.py\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass AddTwoIntsServer(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_server')\n\n        # Create a service server\n        self.srv = self.create_service(\n            AddTwoInts,              # Service type\n            'add_two_ints',          # Service name\n            self.handle_add_request  # Callback\n        )\n\n        self.get_logger().info('AddTwoInts service server ready.')\n\n    def handle_add_request(self, request, response):\n        \"\"\"\n        Called when a client sends a request.\n        Must populate and return the response object.\n        \"\"\"\n        response.sum = request.a + request.b\n        self.get_logger().info(\n            f'Received: {request.a} + {request.b} = {response.sum}'\n        )\n        return response\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = AddTwoIntsServer()\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"the-service-client",children:"The Service Client"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# add_two_ints_client.py\nimport sys\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass AddTwoIntsClient(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_client')\n        self.client = self.create_client(AddTwoInts, 'add_two_ints')\n\n    def call_service(self, a: int, b: int) -> int:\n        # Wait until the server is available\n        while not self.client.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Waiting for service...')\n\n        # Build the request\n        request = AddTwoInts.Request()\n        request.a = a\n        request.b = b\n\n        # Send asynchronously and spin until done\n        future = self.client.call_async(request)\n        rclpy.spin_until_future_complete(self, future)\n\n        result = future.result()\n        self.get_logger().info(\n            f'Result: {a} + {b} = {result.sum}'\n        )\n        return result.sum\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    client_node = AddTwoIntsClient()\n\n    a = int(sys.argv[1]) if len(sys.argv) > 1 else 5\n    b = int(sys.argv[2]) if len(sys.argv) > 2 else 7\n\n    result = client_node.call_service(a, b)\n    print(f'Sum: {result}')\n\n    client_node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.p,{children:"Run the server and client:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Terminal 1\npython3 add_two_ints_server.py\n\n# Terminal 2\npython3 add_two_ints_client.py 42 58\n\n# Or call directly from CLI (no client code needed!)\nros2 service call /add_two_ints example_interfaces/srv/AddTwoInts "{a: 42, b: 58}"\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"28-a-practical-example-sensor-fusion-node",children:"2.8 A Practical Example: Sensor Fusion Node"}),"\n",(0,i.jsx)(n.p,{children:"Let's bring topics and services together in a realistic scenario: a node that subscribes to both a lidar scan and an IMU, fuses them, and exposes a service to report current position confidence."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# sensor_fusion_node.py\nimport rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import LaserScan, Imu\nfrom std_srvs.srv import Trigger\nimport math\n\nclass SensorFusionNode(Node):\n    """\n    A simplified sensor fusion node that:\n    - Subscribes to /scan (lidar) and /imu/data\n    - Maintains a confidence estimate\n    - Exposes /get_confidence service\n    """\n\n    def __init__(self):\n        super().__init__(\'sensor_fusion\')\n\n        # Track last received data\n        self.last_scan = None\n        self.last_imu = None\n        self.confidence = 0.0\n\n        # Subscribers\n        self.scan_sub = self.create_subscription(\n            LaserScan, \'/scan\', self.scan_callback, 10\n        )\n        self.imu_sub = self.create_subscription(\n            Imu, \'/imu/data\', self.imu_callback, 10\n        )\n\n        # Service server: returns confidence as a string\n        self.confidence_srv = self.create_service(\n            Trigger,\n            \'/get_confidence\',\n            self.confidence_callback\n        )\n\n        self.get_logger().info(\'Sensor fusion node started.\')\n\n    def scan_callback(self, msg: LaserScan):\n        self.last_scan = msg\n        self._update_confidence()\n\n    def imu_callback(self, msg: Imu):\n        self.last_imu = msg\n        self._update_confidence()\n\n    def _update_confidence(self):\n        """\n        Simplified confidence: high if we have recent data from both sensors.\n        A real implementation would use Kalman filtering.\n        """\n        has_scan = self.last_scan is not None\n        has_imu = self.last_imu is not None\n        self.confidence = 1.0 if (has_scan and has_imu) else 0.5\n\n    def confidence_callback(self, request, response):\n        response.success = self.confidence > 0.8\n        response.message = (\n            f\'Confidence: {self.confidence:.2f}. \'\n            f\'Scan: {"OK" if self.last_scan else "Missing"}. \'\n            f\'IMU: {"OK" if self.last_imu else "Missing"}.\'\n        )\n        return response\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = SensorFusionNode()\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"29-parameters-runtime-configuration",children:"2.9 Parameters: Runtime Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Parameters allow you to expose tunable values without recompiling. The pattern is:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class ConfigurableNode(Node):\n    def __init__(self):\n        super().__init__('configurable_node')\n\n        # Declare parameters with default values\n        self.declare_parameter('max_speed', 1.0)         # float\n        self.declare_parameter('robot_name', 'robot_1')  # string\n        self.declare_parameter('sensor_ids', [1, 2, 3])  # int array\n\n        # Read parameters\n        self.max_speed = self.get_parameter('max_speed').value\n        self.robot_name = self.get_parameter('robot_name').value\n\n        self.get_logger().info(\n            f'Robot \"{self.robot_name}\" max speed: {self.max_speed} m/s'\n        )\n"})}),"\n",(0,i.jsx)(n.p,{children:"Override parameters at launch time:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"python3 my_node.py --ros-args -p max_speed:=2.5 -p robot_name:=atlas\n"})}),"\n",(0,i.jsx)(n.p,{children:"Or query/set them live:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 param list /configurable_node\nros2 param get /configurable_node max_speed\nros2 param set /configurable_node max_speed 0.5\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"210-introspecting-the-computation-graph",children:"2.10 Introspecting the Computation Graph"}),"\n",(0,i.jsxs)(n.p,{children:["One of ROS 2's greatest strengths is its ",(0,i.jsx)(n.strong,{children:"live introspection"}),". You can inspect any running system without modifying the code."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# See all nodes\nros2 node list\n\n# See all topics with their message types\nros2 topic list -t\n\n# Subscribe to a topic from the command line\nros2 topic echo /temperature\n\n# Measure message frequency\nros2 topic hz /camera/image_raw\n\n# See all information about a node (pubs, subs, services)\nros2 node info /sensor_fusion\n\n# See all services\nros2 service list\n\n# Call a service manually\nros2 service call /get_confidence std_srvs/srv/Trigger {}\n\n# Record all messages to a bag file\nros2 bag record -a -o my_recording\n\n# Play back a bag file\nros2 bag play my_recording\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"ros2 bag"})," tool is invaluable for debugging: you can record a real robot session and replay it offline to develop and test algorithms without the physical hardware."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"211-chapter-summary",children:"2.11 Chapter Summary"}),"\n",(0,i.jsx)(n.p,{children:"This chapter transformed the conceptual understanding from Chapter 1 into working Python code:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Nodes"})," are the basic computational unit. Use the class-based pattern (",(0,i.jsx)(n.code,{children:"class MyNode(Node)"}),") for all real projects."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Publishers"})," send typed messages to named topics. Subscribers receive them. The many-to-many, anonymous nature enables loose coupling between components."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"QoS policies"})," control reliability and latency. Match them between publishers and subscribers to avoid silent disconnections."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Services"})," provide synchronous request/response communication. Use them for infrequent, blocking operations. Prefer topics for streaming data."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Parameters"})," externalise configuration. Declare them with ",(0,i.jsx)(n.code,{children:"declare_parameter()"})," and override them at launch time."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.strong,{children:"ros2 CLI tools"})," (",(0,i.jsx)(n.code,{children:"topic echo"}),", ",(0,i.jsx)(n.code,{children:"node info"}),", ",(0,i.jsx)(n.code,{children:"service call"}),", ",(0,i.jsx)(n.code,{children:"bag record"}),") are essential for debugging and understanding a live system."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"review-questions",children:"Review Questions"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"What is the difference between a publisher and a subscriber? Give a real-world robotics example for each."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Explain why QoS compatibility matters. Write the Python code to create a ",(0,i.jsx)(n.code,{children:"BEST_EFFORT"}),", keep-last-1 publisher for a camera image stream, and explain why you chose those settings."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"A junior developer proposes using a service call to stream a robot's joint positions to a controller at 100 Hz. What is wrong with this approach? What should they use instead?"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Modify the ",(0,i.jsx)(n.code,{children:"TemperatureMonitor"})," node to also publish a ",(0,i.jsx)(n.code,{children:"Bool"})," message on a ",(0,i.jsx)(n.code,{children:"/fever_alert"})," topic whenever the temperature exceeds the threshold. Include the complete modified class code."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Using only ",(0,i.jsx)(n.code,{children:"ros2"})," command-line tools (no code), how would you: (a) verify that the ",(0,i.jsx)(n.code,{children:"sensor_fusion"})," node is running; (b) check what topics it subscribes to; (c) manually inject a message onto ",(0,i.jsx)(n.code,{children:"/imu/data"}),"?"]}),"\n"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},20(e,n,s){s.d(n,{A:()=>l});var r=s(6540),i=s(8774);const t={wrapper:"wrapper_bha3",personalizeBtn:"personalizeBtn_aAG4",loginPrompt:"loginPrompt_KXHJ",showOriginalBtn:"showOriginalBtn_xRLS",personalizedContent:"personalizedContent_IU8L",profileBadge:"profileBadge_N5Y4",loadingText:"loadingText_DKVO",blink:"blink_ny6F"};var o=s(4848);function l(){const[e,n]=(0,r.useState)(!1),[s,l]=(0,r.useState)(null),[a,d]=(0,r.useState)("idle"),[c,h]=(0,r.useState)(""),[p,u]=(0,r.useState)("");(0,r.useEffect)(()=>{n(!0);const e=localStorage.getItem("auth_user");if(e)try{const n=JSON.parse(e);l(n.profile||null)}catch{}},[]);const m=(0,r.useCallback)(async()=>{if(!s)return;d("loading");const e=document.querySelector("article"),n=e?e.innerText:document.body.innerText,r="undefined"!=typeof window&&window.CHATBOT_API_URL?window.CHATBOT_API_URL:"http://localhost:8000";try{const e=await fetch(`${r}/personalize`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:n,experience_level:s.programmingExp||"Beginner",has_gpu:"Yes"===s.hasGPU,ros_experience:s.rosExperience||"none",learning_style:s.learningStyle||"Reading"})});if(!e.ok)throw new Error(`Server error ${e.status}`);const i=await e.json();h(i.personalized_content),d("done")}catch(i){u(i.message),d("error")}},[s]),g=(0,r.useCallback)(()=>{d("idle"),h(""),u("")},[]);return e?s?(0,o.jsxs)("div",{className:t.container,children:["idle"===a&&(0,o.jsx)("button",{className:t.personalizeBtn,onClick:m,children:"\u2728 Personalize for Me"}),"loading"===a&&(0,o.jsx)("button",{className:t.personalizeBtn,disabled:!0,children:"\u23f3 Personalizing\u2026"}),"error"===a&&(0,o.jsxs)("div",{className:t.row,children:[(0,o.jsx)("button",{className:t.personalizeBtn,onClick:m,children:"\u2728 Personalize for Me"}),(0,o.jsxs)("span",{className:t.error,children:["Failed: ",p]})]}),"done"===a&&(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:t.row,children:[(0,o.jsxs)("span",{className:t.badge,children:["\u2728 Personalized for ",s.programmingExp," \xb7 ",s.learningStyle," learner"]}),(0,o.jsx)("button",{className:t.showOriginalBtn,onClick:g,children:"\ud83d\udcc4 Show Original"})]}),(0,o.jsx)("div",{className:t.personalizedContent,children:c})]})]}):(0,o.jsx)("div",{className:t.container,children:(0,o.jsxs)("span",{className:t.loginPrompt,children:["\u2728"," ",(0,o.jsx)(i.A,{to:"/signin",children:"Sign in"})," ","to get content personalised to your experience level."]})}):null}},7132(e,n,s){s.d(n,{A:()=>o});var r=s(6540);const i={wrapper:"wrapper_d2Eb",translateBtn:"translateBtn_zwOG",showOriginalBtn:"showOriginalBtn__IG_",translatedContent:"translatedContent_uGS7",loadingText:"loadingText_YioE",blink:"blink_rXDx"};var t=s(4848);function o(){const[e,n]=(0,r.useState)("idle"),[s,o]=(0,r.useState)(""),[l,a]=(0,r.useState)(""),d=(0,r.useCallback)(async()=>{n("loading");const e=document.querySelector("article"),s=e?e.innerText:document.body.innerText,r="undefined"!=typeof window&&window.CHATBOT_API_URL?window.CHATBOT_API_URL:"http://localhost:8000";try{const e=await fetch(`${r}/translate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:s,target_language:"urdu"})});if(!e.ok)throw new Error(`Server error ${e.status}`);const i=await e.json();o(i.translated_text),n("translated")}catch(i){a(i.message),n("error")}},[]),c=(0,r.useCallback)(()=>{n("idle"),o(""),a("")},[]);return(0,t.jsxs)("div",{className:i.container,children:[("idle"===e||"error"===e)&&(0,t.jsxs)("div",{className:i.row,children:[(0,t.jsx)("button",{className:i.translateBtn,onClick:d,children:"\ud83c\udf10 Translate to Urdu"}),"error"===e&&(0,t.jsxs)("span",{className:i.error,children:["Translation failed: ",l]})]}),"loading"===e&&(0,t.jsx)("button",{className:i.translateBtn,disabled:!0,children:"\u23f3 Translating\u2026"}),"translated"===e&&(0,t.jsxs)("div",{children:[(0,t.jsx)("button",{className:i.showOriginalBtn,onClick:c,children:"\ud83d\udcd6 Show Original English"}),(0,t.jsx)("div",{className:i.translatedContent,dir:"rtl",lang:"ur",children:s})]})]})}},8453(e,n,s){s.d(n,{R:()=>o,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);