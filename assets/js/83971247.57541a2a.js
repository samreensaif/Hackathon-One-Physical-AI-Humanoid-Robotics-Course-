"use strict";(globalThis.webpackChunkphysical_ai_textbook=globalThis.webpackChunkphysical_ai_textbook||[]).push([[5082],{7352(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"module1-ros2/chapter3","title":"Chapter 3: Building ROS 2 Packages","description":"Learning Objectives","source":"@site/docs/module1-ros2/chapter3.mdx","sourceDirName":"module1-ros2","slug":"/module1-ros2/chapter3","permalink":"/Hackathon-One-Physical-AI-Humanoid-Robotics-Course-/docs/module1-ros2/chapter3","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module1-ros2/chapter3.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Chapter 3: Building ROS 2 Packages","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 2: Nodes, Topics, and Services","permalink":"/Hackathon-One-Physical-AI-Humanoid-Robotics-Course-/docs/module1-ros2/chapter2"},"next":{"title":"Chapter 4: Bridging Python AI Agents to ROS 2","permalink":"/Hackathon-One-Physical-AI-Humanoid-Robotics-Course-/docs/module1-ros2/chapter4"}}');var r=s(4848),a=s(8453);const o={title:"Chapter 3: Building ROS 2 Packages",sidebar_position:3},i="Chapter 3: Building ROS 2 Packages",c={},l=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"3.1 Workspaces and Packages",id:"31-workspaces-and-packages",level:2},{value:"The Workspace",id:"the-workspace",level:3},{value:"The Package",id:"the-package",level:3},{value:"3.2 Creating a Python Package",id:"32-creating-a-python-package",level:2},{value:"Step 1: Create the Workspace",id:"step-1-create-the-workspace",level:3},{value:"Step 2: Create the Package",id:"step-2-create-the-package",level:3},{value:"3.3 Anatomy of a Python Package",id:"33-anatomy-of-a-python-package",level:2},{value:"<code>package.xml</code> \u2014 The Manifest",id:"packagexml--the-manifest",level:3},{value:"<code>setup.py</code> \u2014 Entry Points",id:"setuppy--entry-points",level:3},{value:"<code>setup.cfg</code> \u2014 Build Configuration",id:"setupcfg--build-configuration",level:3},{value:"3.4 Adding Your Node Files",id:"34-adding-your-node-files",level:2},{value:"3.5 Custom Message and Service Types",id:"35-custom-message-and-service-types",level:2},{value:"Create the Interfaces Package",id:"create-the-interfaces-package",level:3},{value:"Directory Structure for Interfaces",id:"directory-structure-for-interfaces",level:3},{value:"Defining a Custom Message: <code>RobotStatus.msg</code>",id:"defining-a-custom-message-robotstatusmsg",level:3},{value:"Defining a Custom Service: <code>MoveToPosition.srv</code>",id:"defining-a-custom-service-movetopositionsrv",level:3},{value:"<code>CMakeLists.txt</code> for Interface Package",id:"cmakeliststxt-for-interface-package",level:3},{value:"<code>package.xml</code> for Interface Package",id:"packagexml-for-interface-package",level:3},{value:"Using Custom Messages in Python",id:"using-custom-messages-in-python",level:3},{value:"3.6 Building with Colcon",id:"36-building-with-colcon",level:2},{value:"First Build",id:"first-build",level:3},{value:"Understanding the Build Output",id:"understanding-the-build-output",level:3},{value:"Common Colcon Options",id:"common-colcon-options",level:3},{value:"3.7 Launch Files",id:"37-launch-files",level:2},{value:"A Simple Launch File",id:"a-simple-launch-file",level:3},{value:"Advanced Launch Features",id:"advanced-launch-features",level:3},{value:"3.8 Parameter Files (YAML)",id:"38-parameter-files-yaml",level:2},{value:"3.9 Testing Your Package",id:"39-testing-your-package",level:2},{value:"Writing a Node Unit Test",id:"writing-a-node-unit-test",level:3},{value:"3.10 Complete Package Checklist",id:"310-complete-package-checklist",level:2},{value:"3.11 Chapter Summary",id:"311-chapter-summary",level:2},{value:"Review Questions",id:"review-questions",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"chapter-3-building-ros-2-packages",children:"Chapter 3: Building ROS 2 Packages"})}),"\n",(0,r.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,r.jsx)(n.p,{children:"By the end of this chapter, you will be able to:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Explain the role of a ROS 2 package and a workspace"}),"\n",(0,r.jsxs)(n.li,{children:["Create a Python-based (",(0,r.jsx)(n.code,{children:"ament_python"}),") ROS 2 package from scratch"]}),"\n",(0,r.jsxs)(n.li,{children:["Understand the key files: ",(0,r.jsx)(n.code,{children:"package.xml"}),", ",(0,r.jsx)(n.code,{children:"setup.py"}),", and ",(0,r.jsx)(n.code,{children:"setup.cfg"})]}),"\n",(0,r.jsxs)(n.li,{children:["Create and register node entry points so nodes can be run with ",(0,r.jsx)(n.code,{children:"ros2 run"})]}),"\n",(0,r.jsx)(n.li,{children:"Define custom message and service types in a separate package"}),"\n",(0,r.jsx)(n.li,{children:"Write launch files using the Python launch API to start multiple nodes together"}),"\n",(0,r.jsxs)(n.li,{children:["Build and test a workspace using ",(0,r.jsx)(n.code,{children:"colcon"})]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"31-workspaces-and-packages",children:"3.1 Workspaces and Packages"}),"\n",(0,r.jsx)(n.h3,{id:"the-workspace",children:"The Workspace"}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.strong,{children:"workspace"})," is a directory on your filesystem where you develop and build ROS 2 software. It has a specific structure:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"my_workspace/                  \u2190 Workspace root\n\u251c\u2500\u2500 src/                       \u2190 All source packages go here\n\u2502   \u251c\u2500\u2500 my_robot_pkg/          \u2190 Package A\n\u2502   \u2514\u2500\u2500 my_interfaces_pkg/     \u2190 Package B\n\u251c\u2500\u2500 build/                     \u2190 Created by colcon (compiled artefacts)\n\u251c\u2500\u2500 install/                   \u2190 Created by colcon (installed files)\n\u2514\u2500\u2500 log/                       \u2190 Build logs\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"src/"})," directory is the only part you create manually. ",(0,r.jsx)(n.code,{children:"build/"}),", ",(0,r.jsx)(n.code,{children:"install/"}),", and ",(0,r.jsx)(n.code,{children:"log/"})," are generated by the build tool ",(0,r.jsx)(n.code,{children:"colcon"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"the-package",children:"The Package"}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.strong,{children:"package"})," is the basic unit of distribution in ROS 2. Every package must contain at minimum a ",(0,r.jsx)(n.code,{children:"package.xml"})," manifest file. Packages can be:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Python packages"})," (",(0,r.jsx)(n.code,{children:"ament_python"}),") \u2014 use ",(0,r.jsx)(n.code,{children:"setup.py"})," + ",(0,r.jsx)(n.code,{children:"setup.cfg"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"C++ packages"})," (",(0,r.jsx)(n.code,{children:"ament_cmake"}),") \u2014 use ",(0,r.jsx)(n.code,{children:"CMakeLists.txt"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mixed packages"})," (",(0,r.jsx)(n.code,{children:"ament_cmake_python"}),") \u2014 both, for advanced use cases"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["For AI and Python developers, ",(0,r.jsx)(n.code,{children:"ament_python"})," is the correct choice."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"32-creating-a-python-package",children:"3.2 Creating a Python Package"}),"\n",(0,r.jsx)(n.h3,{id:"step-1-create-the-workspace",children:"Step 1: Create the Workspace"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/ros2_ws/src\ncd ~/ros2_ws\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-create-the-package",children:"Step 2: Create the Package"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws/src\n\n# Syntax: ros2 pkg create --build-type ament_python \\\n#         --dependencies rclpy <package_name>\n\nros2 pkg create --build-type ament_python \\\n    --dependencies rclpy geometry_msgs std_msgs \\\n    my_robot_pkg\n"})}),"\n",(0,r.jsx)(n.p,{children:"This command generates the following structure:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"my_robot_pkg/\n\u251c\u2500\u2500 package.xml\n\u251c\u2500\u2500 setup.py\n\u251c\u2500\u2500 setup.cfg\n\u251c\u2500\u2500 resource/\n\u2502   \u2514\u2500\u2500 my_robot_pkg          \u2190 Marker file (do not delete)\n\u251c\u2500\u2500 test/\n\u2502   \u251c\u2500\u2500 test_copyright.py\n\u2502   \u251c\u2500\u2500 test_flake8.py\n\u2502   \u2514\u2500\u2500 test_pep257.py\n\u2514\u2500\u2500 my_robot_pkg/             \u2190 Python package directory\n    \u2514\u2500\u2500 __init__.py\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"33-anatomy-of-a-python-package",children:"3.3 Anatomy of a Python Package"}),"\n",(0,r.jsxs)(n.h3,{id:"packagexml--the-manifest",children:[(0,r.jsx)(n.code,{children:"package.xml"})," \u2014 The Manifest"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"package.xml"})," describes your package to the ROS 2 tooling. It contains metadata, build type, and dependencies:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<?xml-model href="http://download.ros.org/schema/package_format3.xsd"\n            schematypens="http://www.w3.org/2001/XMLSchema"?>\n<package format="3">\n  <name>my_robot_pkg</name>\n  <version>0.1.0</version>\n  <description>\n    A ROS 2 Python package for controlling my robot.\n  </description>\n\n  <maintainer email="you@example.com">Your Name</maintainer>\n  <license>Apache-2.0</license>\n\n  \x3c!-- Build system --\x3e\n  <buildtool_depend>ament_python</buildtool_depend>\n\n  \x3c!-- Runtime dependencies (what your nodes import) --\x3e\n  <depend>rclpy</depend>\n  <depend>geometry_msgs</depend>\n  <depend>std_msgs</depend>\n  <depend>sensor_msgs</depend>\n\n  \x3c!-- Test dependencies --\x3e\n  <test_depend>ament_lint_auto</test_depend>\n  <test_depend>ament_lint_common</test_depend>\n\n  <export>\n    <build_type>ament_python</build_type>\n  </export>\n</package>\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Dependency types:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<depend>"})," \u2014 needed at build and runtime (use for Python imports)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<build_depend>"})," \u2014 only needed at build time (code generators, compilers)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<exec_depend>"})," \u2014 only needed at runtime"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<test_depend>"})," \u2014 only needed for tests"]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"setuppy--entry-points",children:[(0,r.jsx)(n.code,{children:"setup.py"})," \u2014 Entry Points"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"setup.py"})," is where you tell ROS 2 how to install your package and, critically, ",(0,r.jsx)(n.strong,{children:"register your nodes as executable entry points"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from setuptools import find_packages, setup\nimport os\nfrom glob import glob\n\npackage_name = 'my_robot_pkg'\n\nsetup(\n    name=package_name,\n    version='0.1.0',\n    packages=find_packages(exclude=['test']),\n    data_files=[\n        # Required: installs the marker file for ament\n        ('share/ament_index/resource_index/packages',\n            ['resource/' + package_name]),\n        # Required: installs package.xml\n        ('share/' + package_name, ['package.xml']),\n        # Install launch files (we'll create these later)\n        (os.path.join('share', package_name, 'launch'),\n            glob(os.path.join('launch', '*.launch.py'))),\n        # Install config files\n        (os.path.join('share', package_name, 'config'),\n            glob(os.path.join('config', '*.yaml'))),\n    ],\n    install_requires=['setuptools'],\n    zip_safe=True,\n    maintainer='Your Name',\n    maintainer_email='you@example.com',\n    description='A ROS 2 Python package for controlling my robot.',\n    license='Apache-2.0',\n    tests_require=['pytest'],\n    entry_points={\n        'console_scripts': [\n            # Format: 'command_name = package.module:function'\n            'temperature_sensor = my_robot_pkg.temperature_publisher:main',\n            'temperature_monitor = my_robot_pkg.temperature_monitor:main',\n            'robot_driver = my_robot_pkg.robot_driver:main',\n        ],\n    },\n)\n"})}),"\n",(0,r.jsx)(n.p,{children:"After building, entry points allow:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 run my_robot_pkg temperature_sensor\nros2 run my_robot_pkg robot_driver\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"setupcfg--build-configuration",children:[(0,r.jsx)(n.code,{children:"setup.cfg"})," \u2014 Build Configuration"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ini",children:"[develop]\nscript_dir=$base/lib/my_robot_pkg\n\n[install]\ninstall_scripts=$base/lib/my_robot_pkg\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This file tells ",(0,r.jsx)(n.code,{children:"colcon"})," where to install the executable scripts. Do not modify it."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"34-adding-your-node-files",children:"3.4 Adding Your Node Files"}),"\n",(0,r.jsxs)(n.p,{children:["Place all your Python source files inside the ",(0,r.jsx)(n.code,{children:"my_robot_pkg/"})," subdirectory (the one containing ",(0,r.jsx)(n.code,{children:"__init__.py"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"my_robot_pkg/\n\u2514\u2500\u2500 my_robot_pkg/\n    \u251c\u2500\u2500 __init__.py\n    \u251c\u2500\u2500 temperature_publisher.py    \u2190 Our publisher from Chapter 2\n    \u251c\u2500\u2500 temperature_monitor.py      \u2190 Our subscriber from Chapter 2\n    \u251c\u2500\u2500 robot_driver.py             \u2190 Our velocity commander\n    \u2514\u2500\u2500 sensor_fusion_node.py       \u2190 Our fusion node\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Copy the node code from Chapter 2 into these files. Each file has its own ",(0,r.jsx)(n.code,{children:"main()"})," function, which is the entry point registered in ",(0,r.jsx)(n.code,{children:"setup.py"}),"."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"35-custom-message-and-service-types",children:"3.5 Custom Message and Service Types"}),"\n",(0,r.jsxs)(n.p,{children:["The standard messages in ",(0,r.jsx)(n.code,{children:"std_msgs"})," and ",(0,r.jsx)(n.code,{children:"geometry_msgs"})," cover most cases, but for a professional project you will define your own types. Custom interfaces are always placed in a ",(0,r.jsx)(n.strong,{children:"separate package"})," (",(0,r.jsx)(n.code,{children:"ament_cmake"})," build type, because the code generation tools use CMake)."]}),"\n",(0,r.jsx)(n.h3,{id:"create-the-interfaces-package",children:"Create the Interfaces Package"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws/src\nros2 pkg create --build-type ament_cmake my_robot_interfaces\n"})}),"\n",(0,r.jsx)(n.h3,{id:"directory-structure-for-interfaces",children:"Directory Structure for Interfaces"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"my_robot_interfaces/\n\u251c\u2500\u2500 package.xml\n\u251c\u2500\u2500 CMakeLists.txt\n\u251c\u2500\u2500 msg/\n\u2502   \u251c\u2500\u2500 RobotStatus.msg\n\u2502   \u2514\u2500\u2500 JointState.msg\n\u2514\u2500\u2500 srv/\n    \u251c\u2500\u2500 MoveToPosition.srv\n    \u2514\u2500\u2500 GetBatteryLevel.srv\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"defining-a-custom-message-robotstatusmsg",children:["Defining a Custom Message: ",(0,r.jsx)(n.code,{children:"RobotStatus.msg"})]}),"\n",(0,r.jsxs)(n.p,{children:["Message fields use the syntax ",(0,r.jsx)(n.code,{children:"type field_name [= default_value]"}),". Use ",(0,r.jsx)(n.code,{children:"#"})," for comments:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# RobotStatus.msg\n# Represents the overall status of the robot\n\nstd_msgs/Header header     # Timestamp and frame ID\n\n# Robot identity\nstring robot_id\nstring model_name\n\n# Motion state\nfloat64 battery_level      # Percentage [0.0, 100.0]\nbool is_charging\n\n# Current velocity\ngeometry_msgs/Twist velocity\n\n# Operational mode\nuint8 MODE_IDLE = 0\nuint8 MODE_NAVIGATING = 1\nuint8 MODE_MANIPULATING = 2\nuint8 MODE_EMERGENCY_STOP = 3\nuint8 mode\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"defining-a-custom-service-movetopositionsrv",children:["Defining a Custom Service: ",(0,r.jsx)(n.code,{children:"MoveToPosition.srv"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# MoveToPosition.srv\n# Request: where to move\ngeometry_msgs/Pose target_pose\nfloat64 max_speed          # m/s\nbool avoid_obstacles       # Use obstacle avoidance planner\n---\n# Response: result of the move\nbool success\nstring message\nfloat64 distance_travelled # metres\nfloat64 time_elapsed       # seconds\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"cmakeliststxt-for-interface-package",children:[(0,r.jsx)(n.code,{children:"CMakeLists.txt"})," for Interface Package"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cmake",children:'cmake_minimum_required(VERSION 3.8)\nproject(my_robot_interfaces)\n\n# Find dependencies\nfind_package(ament_cmake REQUIRED)\nfind_package(rosidl_default_generators REQUIRED)\nfind_package(std_msgs REQUIRED)\nfind_package(geometry_msgs REQUIRED)\n\n# Generate messages and services from .msg / .srv files\nrosidl_generate_interfaces(${PROJECT_NAME}\n  "msg/RobotStatus.msg"\n  "msg/JointState.msg"\n  "srv/MoveToPosition.srv"\n  "srv/GetBatteryLevel.srv"\n  DEPENDENCIES std_msgs geometry_msgs\n)\n\nament_export_dependencies(rosidl_default_runtime)\nament_package()\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"packagexml-for-interface-package",children:[(0,r.jsx)(n.code,{children:"package.xml"})," for Interface Package"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<package format="3">\n  <name>my_robot_interfaces</name>\n  <version>0.1.0</version>\n  <description>Custom message and service types for my robot.</description>\n  <maintainer email="you@example.com">Your Name</maintainer>\n  <license>Apache-2.0</license>\n\n  <buildtool_depend>ament_cmake</buildtool_depend>\n  <buildtool_depend>rosidl_default_generators</buildtool_depend>\n\n  <depend>std_msgs</depend>\n  <depend>geometry_msgs</depend>\n\n  <exec_depend>rosidl_default_runtime</exec_depend>\n\n  <member_of_group>rosidl_interface_packages</member_of_group>\n\n  <export>\n    <build_type>ament_cmake</build_type>\n  </export>\n</package>\n'})}),"\n",(0,r.jsx)(n.h3,{id:"using-custom-messages-in-python",children:"Using Custom Messages in Python"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# In your node file:\nfrom my_robot_interfaces.msg import RobotStatus\nfrom my_robot_interfaces.srv import MoveToPosition\n\n# Publishing a RobotStatus\nstatus_pub = self.create_publisher(RobotStatus, '/robot/status', 10)\n\nmsg = RobotStatus()\nmsg.header.stamp = self.get_clock().now().to_msg()\nmsg.robot_id = 'robot_001'\nmsg.battery_level = 87.3\nmsg.mode = RobotStatus.MODE_NAVIGATING\n\nstatus_pub.publish(msg)\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"36-building-with-colcon",children:"3.6 Building with Colcon"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"colcon"})," is the ROS 2 build tool. It scans your ",(0,r.jsx)(n.code,{children:"src/"})," directory, resolves inter-package dependencies, and builds everything in the correct order."]}),"\n",(0,r.jsx)(n.h3,{id:"first-build",children:"First Build"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\n\n# Build all packages\ncolcon build\n\n# Build only specific packages (faster for large workspaces)\ncolcon build --packages-select my_robot_pkg my_robot_interfaces\n\n# Build with symlinks (changes to Python files take effect without rebuilding)\ncolcon build --symlink-install\n"})}),"\n",(0,r.jsx)(n.p,{children:"After building, source the workspace:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'source ~/ros2_ws/install/setup.bash\n\n# Add to ~/.bashrc so it is sourced automatically in every new terminal:\necho "source ~/ros2_ws/install/setup.bash" >> ~/.bashrc\n'})}),"\n",(0,r.jsx)(n.h3,{id:"understanding-the-build-output",children:"Understanding the Build Output"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"~/ros2_ws/install/my_robot_pkg/\n\u251c\u2500\u2500 lib/\n\u2502   \u2514\u2500\u2500 my_robot_pkg/\n\u2502       \u251c\u2500\u2500 temperature_sensor    \u2190 Installed executable (from entry_points)\n\u2502       \u2514\u2500\u2500 robot_driver\n\u251c\u2500\u2500 share/\n\u2502   \u2514\u2500\u2500 my_robot_pkg/\n\u2502       \u251c\u2500\u2500 package.xml\n\u2502       \u2514\u2500\u2500 launch/\n\u2502           \u2514\u2500\u2500 full_robot.launch.py\n"})}),"\n",(0,r.jsx)(n.h3,{id:"common-colcon-options",children:"Common Colcon Options"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Run tests after building\ncolcon test --packages-select my_robot_pkg\n\n# See test results\ncolcon test-result --verbose\n\n# Clean build artefacts (like 'make clean')\nrm -rf build/ install/ log/\n\n# Skip a package\ncolcon build --packages-skip my_robot_interfaces\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"37-launch-files",children:"3.7 Launch Files"}),"\n",(0,r.jsxs)(n.p,{children:["Running a full robot system means starting dozens of nodes simultaneously. ",(0,r.jsx)(n.strong,{children:"Launch files"})," automate this. ROS 2 uses a Python-based launch API."]}),"\n",(0,r.jsx)(n.h3,{id:"a-simple-launch-file",children:"A Simple Launch File"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"launch/robot.launch.py"})," inside your package:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# launch/robot.launch.py\nfrom launch import LaunchDescription\nfrom launch_ros.actions import Node\n\ndef generate_launch_description():\n    \"\"\"\n    This function is the entry point for the launch system.\n    It must return a LaunchDescription object.\n    \"\"\"\n    return LaunchDescription([\n\n        # Start the temperature sensor node\n        Node(\n            package='my_robot_pkg',\n            executable='temperature_sensor',\n            name='temp_sensor_node',           # Remaps node name\n            output='screen',                   # Log to terminal\n        ),\n\n        # Start the temperature monitor node\n        Node(\n            package='my_robot_pkg',\n            executable='temperature_monitor',\n            name='temp_monitor_node',\n            output='screen',\n        ),\n\n        # Start the robot driver with a custom parameter\n        Node(\n            package='my_robot_pkg',\n            executable='robot_driver',\n            name='driver_node',\n            output='screen',\n            parameters=[{'max_speed': 1.5}],\n        ),\n    ])\n"})}),"\n",(0,r.jsx)(n.p,{children:"Run the launch file:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 launch my_robot_pkg robot.launch.py\n"})}),"\n",(0,r.jsx)(n.h3,{id:"advanced-launch-features",children:"Advanced Launch Features"}),"\n",(0,r.jsx)(n.p,{children:"Launch files support arguments, remapping, namespacing, and conditional logic:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# launch/full_robot.launch.py\nimport os\nfrom launch import LaunchDescription\nfrom launch.actions import (\n    DeclareLaunchArgument,\n    GroupAction,\n    IncludeLaunchDescription,\n    LogInfo,\n)\nfrom launch.conditions import IfCondition\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\nfrom launch.substitutions import LaunchConfiguration, PathJoinSubstitution\nfrom launch_ros.actions import Node, PushRosNamespace\nfrom ament_index_python.packages import get_package_share_directory\n\ndef generate_launch_description():\n\n    # --- Declare launch arguments ---\n    use_sim_arg = DeclareLaunchArgument(\n        'use_sim',\n        default_value='false',\n        description='Launch in simulation mode'\n    )\n    robot_name_arg = DeclareLaunchArgument(\n        'robot_name',\n        default_value='my_robot',\n        description='Name of the robot (used for namespacing)'\n    )\n\n    use_sim = LaunchConfiguration('use_sim')\n    robot_name = LaunchConfiguration('robot_name')\n\n    # --- Nodes ---\n    sensor_node = Node(\n        package='my_robot_pkg',\n        executable='temperature_sensor',\n        output='screen',\n        # Remap: change topic names at launch without modifying code\n        remappings=[\n            ('/temperature', '/robot/temperature'),\n        ],\n        # Load parameters from a YAML file\n        parameters=[\n            os.path.join(\n                get_package_share_directory('my_robot_pkg'),\n                'config', 'sensor_params.yaml'\n            )\n        ],\n    )\n\n    monitor_node = Node(\n        package='my_robot_pkg',\n        executable='temperature_monitor',\n        output='screen',\n        remappings=[('/temperature', '/robot/temperature')],\n    )\n\n    # This node only launches if use_sim:=true\n    sim_node = Node(\n        package='my_robot_pkg',\n        executable='robot_driver',\n        output='screen',\n        condition=IfCondition(use_sim),\n    )\n\n    # Group nodes under a namespace (all topics prefixed with /my_robot/)\n    namespaced_group = GroupAction([\n        PushRosNamespace(robot_name),\n        sensor_node,\n        monitor_node,\n    ])\n\n    return LaunchDescription([\n        use_sim_arg,\n        robot_name_arg,\n        LogInfo(msg=['Launching robot: ', robot_name]),\n        namespaced_group,\n        sim_node,\n    ])\n"})}),"\n",(0,r.jsx)(n.p,{children:"Run with arguments:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 launch my_robot_pkg full_robot.launch.py use_sim:=true robot_name:=atlas\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"38-parameter-files-yaml",children:"3.8 Parameter Files (YAML)"}),"\n",(0,r.jsx)(n.p,{children:"For complex configurations, store parameters in a YAML file rather than hardcoding them in the launch file:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# config/sensor_params.yaml\n/temperature_sensor:\n  ros__parameters:\n    publish_rate: 5.0          # Hz\n    min_temp: 35.0             # \xb0C\n    max_temp: 42.0             # \xb0C\n    sensor_id: "sensor_left_arm"\n\n/temperature_monitor:\n  ros__parameters:\n    fever_threshold: 38.5      # \xb0C\n    alert_cooldown: 5.0        # seconds between alerts\n'})}),"\n",(0,r.jsx)(n.p,{children:"Load in launch file:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"Node(\n    package='my_robot_pkg',\n    executable='temperature_sensor',\n    parameters=[os.path.join(pkg_share, 'config', 'sensor_params.yaml')],\n)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Or on the command line:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 run my_robot_pkg temperature_sensor \\\n    --ros-args --params-file config/sensor_params.yaml\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"39-testing-your-package",children:"3.9 Testing Your Package"}),"\n",(0,r.jsxs)(n.p,{children:["ROS 2 uses ",(0,r.jsx)(n.code,{children:"pytest"})," for Python tests. Tests live in the ",(0,r.jsx)(n.code,{children:"test/"})," directory."]}),"\n",(0,r.jsx)(n.h3,{id:"writing-a-node-unit-test",children:"Writing a Node Unit Test"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# test/test_temperature_publisher.py\nimport pytest\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float64\nfrom my_robot_pkg.temperature_publisher import TemperatureSensor\n\n@pytest.fixture(autouse=True)\ndef ros_context():\n    rclpy.init()\n    yield\n    rclpy.shutdown()\n\ndef test_temperature_in_valid_range():\n    """Test that published temperatures are within expected bounds."""\n    node = TemperatureSensor()\n\n    received_messages = []\n\n    # Create a helper subscriber\n    test_node = Node(\'test_node\')\n    test_node.create_subscription(\n        Float64,\n        \'/temperature\',\n        lambda msg: received_messages.append(msg.data),\n        10\n    )\n\n    # Spin for a short time to receive a message\n    import time\n    end_time = time.time() + 3.0\n    while time.time() < end_time and len(received_messages) == 0:\n        rclpy.spin_once(node, timeout_sec=0.1)\n        rclpy.spin_once(test_node, timeout_sec=0.1)\n\n    node.destroy_node()\n    test_node.destroy_node()\n\n    assert len(received_messages) > 0, "No temperature messages received"\n    for temp in received_messages:\n        assert 36.0 <= temp <= 40.0, f"Temperature {temp} out of range"\n\ndef test_node_name():\n    node = TemperatureSensor()\n    assert node.get_name() == \'temperature_sensor\'\n    node.destroy_node()\n'})}),"\n",(0,r.jsx)(n.p,{children:"Run tests:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"colcon test --packages-select my_robot_pkg\ncolcon test-result --verbose\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"310-complete-package-checklist",children:"3.10 Complete Package Checklist"}),"\n",(0,r.jsx)(n.p,{children:"Before releasing a ROS 2 package, verify:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u2705  package.xml has correct name, version, maintainer, license\n\u2705  All Python imports appear as <depend> in package.xml\n\u2705  All node entry points registered in setup.py console_scripts\n\u2705  setup.py includes data_files for launch/ and config/ directories\n\u2705  Launch file starts all required nodes\n\u2705  Parameter YAML file covers all tunable values\n\u2705  At least one test per node in test/\n\u2705  colcon build --packages-select <name> succeeds with no warnings\n\u2705  colcon test --packages-select <name> passes\n\u2705  ros2 run <pkg> <node> works after sourcing install/setup.bash\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"311-chapter-summary",children:"3.11 Chapter Summary"}),"\n",(0,r.jsx)(n.p,{children:"This chapter gave you the skills to structure professional ROS 2 projects:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Workspaces"})," separate source code from build artefacts. Always work inside ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Python packages"})," (",(0,r.jsx)(n.code,{children:"ament_python"}),") require ",(0,r.jsx)(n.code,{children:"package.xml"})," (metadata), ",(0,r.jsx)(n.code,{children:"setup.py"})," (entry points and data files), and ",(0,r.jsx)(n.code,{children:"setup.cfg"})," (install paths)."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Custom interfaces"})," go in a separate ",(0,r.jsx)(n.code,{children:"ament_cmake"})," package. Messages (",(0,r.jsx)(n.code,{children:".msg"}),") define topic types; services (",(0,r.jsx)(n.code,{children:".srv"}),") define service types."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"colcon build"})})," resolves dependencies and builds all packages. Always use ",(0,r.jsx)(n.code,{children:"--symlink-install"})," during development to avoid rebuilding after every Python change."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Launch files"})," orchestrate multi-node systems with arguments, remappings, namespaces, and conditional logic."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Parameter YAML files"})," externalise configuration and are loaded at launch time."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Tests"})," use ",(0,r.jsx)(n.code,{children:"pytest"})," and are run with ",(0,r.jsx)(n.code,{children:"colcon test"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"review-questions",children:"Review Questions"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Why are custom message types defined in a separate ",(0,r.jsx)(n.code,{children:"ament_cmake"})," package instead of inside your ",(0,r.jsx)(n.code,{children:"ament_python"})," application package?"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["What is the purpose of the ",(0,r.jsx)(n.code,{children:"entry_points"})," section in ",(0,r.jsx)(n.code,{children:"setup.py"}),"? What would happen if you forgot to register a node there?"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Write the ",(0,r.jsx)(n.code,{children:"package.xml"})," for a package called ",(0,r.jsx)(n.code,{children:"arm_controller_pkg"})," that depends on ",(0,r.jsx)(n.code,{children:"rclpy"}),", ",(0,r.jsx)(n.code,{children:"sensor_msgs"}),", and a custom package called ",(0,r.jsx)(n.code,{children:"my_robot_interfaces"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Explain the difference between these two colcon commands:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"colcon build"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"colcon build --symlink-install"}),"\nWhen would you use each one?"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Write a launch file that starts two nodes \u2014 ",(0,r.jsx)(n.code,{children:"camera_driver"})," from ",(0,r.jsx)(n.code,{children:"camera_pkg"})," and ",(0,r.jsx)(n.code,{children:"object_detector"})," from ",(0,r.jsx)(n.code,{children:"vision_pkg"})," \u2014 where both are placed under the namespace ",(0,r.jsx)(n.code,{children:"/robot_1"}),", and the object detector receives a launch argument ",(0,r.jsx)(n.code,{children:"model_path"})," that defaults to ",(0,r.jsx)(n.code,{children:"/models/yolo.pt"}),"."]}),"\n"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>o,x:()=>i});var t=s(6540);const r={},a=t.createContext(r);function o(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);